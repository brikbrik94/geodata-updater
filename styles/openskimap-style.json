{
  "version": 8,
  "name": "OpenSkiMap Overlay",
  "glyphs": "{TILES_BASE_URL}/assets/fonts/{fontstack}/{range}.pbf",
  "sources": {
    "ski_source": {
      "type": "vector",
      "url": "pmtiles://{TILES_BASE_URL}/openskimap.pmtiles",
      "attribution": "OpenSkiMap.org"
    }
  },
  "layers": [
    {
      "id": "ski-areas",
      "type": "fill",
      "source": "ski_source",
      "source-layer": "ski_areas_multipolygon",
      "paint": {
        "fill-color": "#7fc97f",
        "fill-opacity": 0.1
      }
    },
    {
      "id": "ski-runs-alpine-casing",
      "type": "line",
      "source": "ski_source",
      "source-layer": "runs_linestring",
      "filter": [
        "!=",
        [
          "get",
          "uses"
        ],
        "nordic"
      ],
      "layout": {
        "line-cap": "round",
        "line-join": "round",
        "visibility": "visible"
      },
      "paint": {
        "line-color": "#ffffff",
        "line-opacity": [
          "*",
          [
            "case",
            [
              "in",
              [
                "get",
                "status"
              ],
              [
                "literal",
                [
                  "abandoned",
                  "disused",
                  "never_opened"
                ]
              ]
            ],
            0.35,
            [
              "in",
              [
                "get",
                "status"
              ],
              [
                "literal",
                [
                  "construction",
                  "planned",
                  "proposed"
                ]
              ]
            ],
            0.55,
            0.85
          ],
          0.9
        ],
        "line-width": [
          "+",
          [
            "case",
            [
              "in",
              [
                "get",
                "difficulty"
              ],
              [
                "literal",
                [
                  "expert",
                  "extreme"
                ]
              ]
            ],
            [
              "*",
              [
                "interpolate",
                [
                  "linear"
                ],
                [
                  "zoom"
                ],
                6,
                0.8,
                9,
                1.4,
                12,
                2.2,
                14,
                3.0
              ],
              1.25
            ],
            [
              "==",
              [
                "get",
                "difficulty"
              ],
              "advanced"
            ],
            [
              "*",
              [
                "interpolate",
                [
                  "linear"
                ],
                [
                  "zoom"
                ],
                6,
                0.8,
                9,
                1.4,
                12,
                2.2,
                14,
                3.0
              ],
              1.15
            ],
            [
              "==",
              [
                "get",
                "difficulty"
              ],
              "intermediate"
            ],
            [
              "*",
              [
                "interpolate",
                [
                  "linear"
                ],
                [
                  "zoom"
                ],
                6,
                0.8,
                9,
                1.4,
                12,
                2.2,
                14,
                3.0
              ],
              1.05
            ],
            [
              "interpolate",
              [
                "linear"
              ],
              [
                "zoom"
              ],
              6,
              0.8,
              9,
              1.4,
              12,
              2.2,
              14,
              3.0
            ]
          ],
          1.2
        ],
        "line-linecap": "round",
        "line-linejoin": "round"
      }
    },
    {
      "id": "ski-runs-alpine",
      "type": "line",
      "source": "ski_source",
      "source-layer": "runs_linestring",
      "filter": [
        "!=",
        [
          "get",
          "uses"
        ],
        "nordic"
      ],
      "layout": {
        "line-join": "round",
        "line-cap": "round",
        "visibility": "visible"
      },
      "paint": {
        "line-width": [
          "case",
          [
            "in",
            [
              "get",
              "difficulty"
            ],
            [
              "literal",
              [
                "expert",
                "extreme"
              ]
            ]
          ],
          [
            "*",
            [
              "interpolate",
              [
                "linear"
              ],
              [
                "zoom"
              ],
              6,
              0.8,
              9,
              1.4,
              12,
              2.2,
              14,
              3.0
            ],
            1.25
          ],
          [
            "==",
            [
              "get",
              "difficulty"
            ],
            "advanced"
          ],
          [
            "*",
            [
              "interpolate",
              [
                "linear"
              ],
              [
                "zoom"
              ],
              6,
              0.8,
              9,
              1.4,
              12,
              2.2,
              14,
              3.0
            ],
            1.15
          ],
          [
            "==",
            [
              "get",
              "difficulty"
            ],
            "intermediate"
          ],
          [
            "*",
            [
              "interpolate",
              [
                "linear"
              ],
              [
                "zoom"
              ],
              6,
              0.8,
              9,
              1.4,
              12,
              2.2,
              14,
              3.0
            ],
            1.05
          ],
          [
            "interpolate",
            [
              "linear"
            ],
            [
              "zoom"
            ],
            6,
            0.8,
            9,
            1.4,
            12,
            2.2,
            14,
            3.0
          ]
        ],
        "line-color": [
          "match",
          [
            "get",
            "difficulty"
          ],
          "novice",
          "#2ecc71",
          "easy",
          "#2ecc71",
          "intermediate",
          "#3498db",
          "advanced",
          "#e74c3c",
          "expert",
          "#2c3e50",
          "extreme",
          "#8e44ad",
          "freeride",
          "#f39c12",
          "#95a5a6"
        ],
        "line-opacity": [
          "case",
          [
            "in",
            [
              "get",
              "status"
            ],
            [
              "literal",
              [
                "abandoned",
                "disused",
                "never_opened"
              ]
            ]
          ],
          0.35,
          [
            "in",
            [
              "get",
              "status"
            ],
            [
              "literal",
              [
                "construction",
                "planned",
                "proposed"
              ]
            ]
          ],
          0.55,
          0.85
        ],
        "line-dasharray": [
          "case",
          [
            "has",
            "uses"
          ],
          [
            "case",
            [
              "in",
              "connection",
              [
                "split",
                [
                  "get",
                  "uses"
                ],
                ","
              ]
            ],
            [
              "literal",
              [
                2,
                2
              ]
            ],
            [
              "in",
              "sled",
              [
                "split",
                [
                  "get",
                  "uses"
                ],
                ","
              ]
            ],
            [
              "literal",
              [
                1,
                2
              ]
            ],
            [
              "in",
              "nordic",
              [
                "split",
                [
                  "get",
                  "uses"
                ],
                ","
              ]
            ],
            [
              "literal",
              [
                1,
                1.5
              ]
            ],
            [
              "literal",
              [
                1,
                0
              ]
            ]
          ],
          [
            "literal",
            [
              1,
              0
            ]
          ]
        ],
        "line-linecap": "round",
        "line-linejoin": "round"
      }
    },
    {
      "id": "ski-runs-labels",
      "type": "symbol",
      "source": "ski_source",
      "source-layer": "runs_linestring",
      "minzoom": 13,
      "filter": [
        "all",
        [
          "has",
          "name"
        ]
      ],
      "layout": {
        "symbol-placement": "line",
        "text-field": [
          "get",
          "name"
        ],
        "text-size": [
          "interpolate",
          [
            "linear"
          ],
          [
            "zoom"
          ],
          13,
          10,
          14,
          12
        ],
        "text-font": [
          "Noto Sans Regular"
        ],
        "text-rotation-alignment": "map",
        "text-keep-upright": false,
        "text-max-angle": 30,
        "text-letter-spacing": 0.05,
        "text-padding": 2
      },
      "paint": {
        "text-halo-color": "#ffffff",
        "text-halo-width": 1.2,
        "text-color": "#2c3e50",
        "text-opacity": 0.9
      }
    },
    {
      "id": "ski-runs-nordic",
      "type": "line",
      "source": "ski_source",
      "source-layer": "runs_linestring",
      "filter": [
        "==",
        [
          "get",
          "uses"
        ],
        "nordic"
      ],
      "layout": {
        "line-join": "round"
      },
      "paint": {
        "line-width": 2,
        "line-color": "#ff6600",
        "line-dasharray": [
          3,
          2
        ]
      }
    },
    {
      "id": "ski-lifts-line",
      "type": "line",
      "source": "ski_source",
      "source-layer": "lifts_linestring",
      "paint": {
        "line-color": "#333",
        "line-width": [
          "match",
          [
            "get",
            "lift_type"
          ],
          "cable_car",
          2,
          1
        ],
        "line-dasharray": [
          "match",
          [
            "get",
            "lift_type"
          ],
          "funicular",
          [
            1,
            0
          ],
          [
            4,
            1
          ]
        ]
      }
    },
    {
      "id": "ski-lifts-icons",
      "type": "symbol",
      "source": "ski_source",
      "source-layer": "lifts_linestring",
      "minzoom": 13,
      "layout": {
        "symbol-placement": "line",
        "symbol-spacing": 150,
        "icon-image": [
          "match",
          [
            "get",
            "lift_type"
          ],
          "gondola",
          "ski-gondola",
          "cable_car",
          "ski-cable-car",
          "funicular",
          "ski-funicular",
          "chair_lift",
          [
            "match",
            [
              "case",
              [
                "==",
                [
                  "get",
                  "occupancy"
                ],
                null
              ],
              2,
              [
                "<=",
                [
                  "to-number",
                  [
                    "get",
                    "occupancy"
                  ]
                ],
                0
              ],
              2,
              [
                ">",
                [
                  "to-number",
                  [
                    "get",
                    "occupancy"
                  ]
                ],
                8
              ],
              8,
              [
                "round",
                [
                  "to-number",
                  [
                    "get",
                    "occupancy"
                  ]
                ]
              ]
            ],
            1,
            "ski-chairlift-1",
            2,
            "ski-chairlift-2",
            3,
            "ski-chairlift-3",
            4,
            "ski-chairlift-4",
            6,
            "ski-chairlift-6",
            8,
            "ski-chairlift-8",
            "ski-chairlift-2"
          ],
          "t-bar",
          "ski-drag-lift-tbar",
          "j-bar",
          "ski-drag-lift-tbar",
          "platter",
          "ski-drag-lift-platter",
          "drag_lift",
          "ski-drag-lift-tbar",
          "magic_carpet",
          "ski-magic-carpet",
          "rope_tow",
          "ski-rope-tow",
          "ski-gondola"
        ],
        "icon-size": 0.7,
        "icon-allow-overlap": false,
        "icon-ignore-placement": true
      }
    },
    {
      "id": "ski-labels",
      "type": "symbol",
      "source": "ski_source",
      "source-layer": "runs_linestring",
      "minzoom": 14,
      "layout": {
        "text-field": [
          "get",
          "name"
        ],
        "text-font": [
          "Arial Regular"
        ],
        "text-size": 10,
        "symbol-placement": "line",
        "text-offset": [
          0,
          1
        ]
      },
      "paint": {
        "text-color": "#333",
        "text-halo-color": "#fff",
        "text-halo-width": 1.5
      }
    }
  ],
  "sprite": "{SPRITE_BASE_URL}/sprite"
}
